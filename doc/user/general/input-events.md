# Input Events

## Events

An input event generated by some device (e.g. a GLFW window) is comprised of:
* the event _descriptor_
* the X-Y location (for events that have a location)

The descriptor is the static properties of an event and is comprised of:
* the event _category_
* the optional button _identifier_ and _operation_

A descriptor is retrieved using `Event.Descriptor.of()` and an event is instantiated via one of the `Event.of(Descriptor, ...)` methods.

The following code illustrates a fictitious input device handler for a mouse movement event:

```
void mousemove(int x, int y) {
	final Event event = Event.of(Event.Descriptor.MOVE, x, y);
	...
}
```

Note that the descriptor in this case is the `Event.Descriptor.MOVE` constant since there is only one type of movement event.

This code illustrates a keyboard event:

```
void key(int key, int action, int mods) {
	final Event.Operation op = ...
	final Event.Descriptor descriptor = Event.Descriptor.of(Event.Category.BUTTON, key, op);
	final Event event = Event.of(descriptor);
	...
}
```

where:
* `key` is the native key identifier, e.g. 32 for the space bar on most platforms
* `action` specifies whether the key is being pressed or released
* `mods` are the modifier keys
	
The native `action` is mapped to the corresponding platform-neutral `Event.Operation`.

Note that in this case we retrieve the descriptor for the given `key` using `Event.Descriptor.of()` with the the appropriate category since there are multiple descriptors for keyboard events. Also the `Event.of()` method obviously does not require a location for a keyboard event.

In general an exception will be thrown if either method is invoked with an invalid argument. The following table specifies what data is required for each category of event:

| category | descriptor | location |
| -------- | ---------- | -------- |
| button   | yes        | no       |
| click    | yes        | yes      |
| move     | no			| yes      |
| zoom     | no			| yes      |

where:
* _category_ is an `Event.Category`
* _descriptor_ specifies whether the event is retrieved via `Event.Descriptor.of()` or is a constant (`Event.Descriptor.MOVE` or `Event.Descriptor.ZOOM`)
* _location_ specifies whether the event requires a location

## Action Bindings

Action bindings are used to associated events with actions.

First an action binding instance is created and populated with the application-specific actions:

```java

// Define an action class for our application
class CustomAction { ... }

// Create an action
CustomAction pause = new CustomAction(...);

// Create bindings
Bindings bindings = new Bindings();

// Register our action
bindings.add(pause, handler);
```

where the `handler` is an instance of `Event.Handler` that is invoked when the appropriate event is received.

An event _descriptor_ is bound to an action as follows:

```java
// Define the event
Event.Descriptor descriptor = Event.Descriptor.of(Event.Category.BUTTON, 32, Event.Operation.PRESS);

// Bind to our action
bindings.bind(pause, descriptor);

// Alternatively
final Bindings.Action action = bindings.action(pause);
action.bind(descriptor);
```

This binds the keyboard space bar to our pause event handler.

On receipt of an event from an input device we delegate to the bindings:

```java
// Received event
Event event = ...

// Delegate to the action bound to this event
bindings.find(event.descriptor()).ifPresent(handler -> handler.handle(event));

// Or more conveniently get a handler for the whole set of bindings
Event.Handler handler = binding.handler();
handler.handle(event);
```

Bindings can be removed and cleared:

```java
// Remove our binding
bindings.remove(descriptor);

// Remove all bindings
bindings.clear();
```

Note that attempting to replace an existing binding will result in an exception.

Bindings can be persisted and loaded:

```java
// Persist to storage
bindings.write(store);

// Load from storage
bindings.read(store);
```

Note that all the actions must be registered to the bindings objects before the bindings can be loaded from storage.

The data format of the persisted bindings is a carriage-return delimited text file with each bindings stored as: `action category [operation identifier]`

Example:

```
mousemove		MOVE 
mousezoom		ZOOM
pause			BUTTON-PRESS-32
click			CLICK-PRESS-1
```

## Input Devices

TODO




